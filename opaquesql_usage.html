<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="Configuration" href="config/index.html" /><link rel="prev" title="Quickstart" href="quickstart.html" />

    <meta name="generator" content="sphinx-4.4.0, furo 2022.01.02"/>
        <title>Usage with Opaque SQL - MC2 Client documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?digest=df49af52631e7917044a9c21a57f7b83170a6dd0" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?digest=fade93df149f7c5fedb3ff897f799dc7d283b420" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  --color-brand-primary: #00B0FF;
  --color-brand-content: #00B0FF;
  --color-admonition-background: #3681da;
  
  }
  body[data-theme="dark"] {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
  }
  @media (prefers-color-scheme: dark) {
    body:not([data-theme="light"]) {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
  }
</style></head>
  <body>
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" />
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">MC<sup>2</sup> Client  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  
  <span class="sidebar-brand-text">MC<sup>2</sup> Client  documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Usage with Opaque SQL</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="config/index.html">Configuration</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="config/config.html">Global Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="config/azure.html">Azure Configuration</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="python/index.html">Python Interface</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="python/usage.html">Python Package Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="python/api.html">API Reference</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="cli/index.html">CLI Interface</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="cli/usage.html">CLI Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="cli/api.html">CLI Reference</a></li>
</ul>
</li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="usage-with-opaque-sql">
<h1>Usage with Opaque SQL<a class="headerlink" href="#usage-with-opaque-sql" title="Permalink to this headline">¶</a></h1>
<p>MC<sup>2</sup> offers <a class="reference external" href="https://mc2-project.github.io/opaque-sql/">Opaque SQL</a>, a secure analytics engine built on top of Apache Spark SQL, as a compute service that users can run. Opaque SQL provides a Scala and Python interface for users to express their desired SQL-like computation. MC<sup>2</sup> Client integrates directly with Opaque SQL, and enables users to start the Opaque SQL service as well as encrypt and decrypt data in a format readable by Opaque SQL.</p>
<p>First, install Opaque SQL by following <a class="reference external" href="https://mc2-project.github.io/opaque-sql/install/install.html">this guide</a>.</p>
<p>Next, to use MC<sup>2</sup> Client for Opaque SQL, you’ll need to specifically modify several sections of the <a class="reference internal" href="config/config.html"><span class="doc">configuration</span></a>: the <code class="docutils literal notranslate"><span class="pre">start</span></code>, <code class="docutils literal notranslate"><span class="pre">upload</span></code>, <code class="docutils literal notranslate"><span class="pre">run</span></code>, and <code class="docutils literal notranslate"><span class="pre">download</span></code> sections. Once you’ve finished configuration, look at the <a class="reference internal" href="quickstart.html"><span class="doc">Quickstart</span></a> guide on how to securely run a query.</p>
<section id="start">
<h2>Start<a class="headerlink" href="#start" title="Permalink to this headline">¶</a></h2>
<p>In the <code class="docutils literal notranslate"><span class="pre">start</span></code> section, you must specify the command to launch the Opaque SQL service on the head node. This is usually one of three things, depending on how you want to start Opaque SQL. The section should look something like this:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">start</span><span class="p">:</span><span class="w"></span>
<span class="w">   </span><span class="c1"># Commands to run on head node</span><span class="w"></span>
<span class="w">   </span><span class="nt">head</span><span class="p">:</span><span class="w"></span>
<span class="w">   </span><span class="c1"># To run Opaque SQL locally (Scala)</span><span class="w"></span>
<span class="w">   </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cd /path/to/opaque-sql; build/sbt run</span><span class="w"></span>

<span class="w">   </span><span class="c1"># Or to run a standalone Spark cluster (Scala)</span><span class="w"></span>
<span class="w">   </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cd /path/to/opaque-sql; build/sbt assembly</span><span class="w"></span>
<span class="w">   </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cd /path/to/opaque-sql; spark-submit --class edu.berkeley.cs.rise.opaque.rpc.Listener &lt;Spark configuration parameters&gt; --deploy-mode client ${MC2_HOME}/target/scala-2.12/opaque-assembly-0.1.jar</span><span class="w"></span>

<span class="w">   </span><span class="c1"># Or to run a standalone PySpark cluster (Python)</span><span class="w"></span>
<span class="w">   </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cd /path/to/opaque-sql; build/sbt assembly</span><span class="w"></span>
<span class="w">   </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cd /path/to/opaque-sql; spark-submit &lt;Spark configuration parameters&gt; --deploy-mode client --jars ${MC2_HOME}/target/scala-2.12/opaque-assembly-0.1.jar --py-files ${MC2_HOME}/target/python.zip ${MC2_HOME}/target/python/listener.py</span><span class="w"></span>

<span class="w">   </span><span class="c1"># Commands to run on worker nodes</span><span class="w"></span>
<span class="w">   </span><span class="nt">workers</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="upload">
<h2>Upload<a class="headerlink" href="#upload" title="Permalink to this headline">¶</a></h2>
<p>In the <code class="docutils literal notranslate"><span class="pre">upload</span></code> section, you should tell MC<sup>2</sup> Client that you want to encrypt data in <code class="docutils literal notranslate"><span class="pre">sql</span></code> format, the format readable by Opaque SQL. Along with the data, you should specify the path to the data schema. More on the schema format can be found <a class="reference internal" href="cli/usage.html#sqlformat"><span class="std std-ref">here</span></a>.</p>
<p>The section should look something like this:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">upload</span><span class="p">:</span><span class="w"></span>
<span class="w">   </span><span class="c1"># Whether to upload data to Azure blob storage or disk</span><span class="w"></span>
<span class="w">   </span><span class="c1"># Allowed values are `blob` or `disk`</span><span class="w"></span>
<span class="w">   </span><span class="c1"># If `blob`, Azure CLI will be called to upload data</span><span class="w"></span>
<span class="w">   </span><span class="c1"># Else, `scp` will be used</span><span class="w"></span>
<span class="w">   </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">disk</span><span class="w"></span>

<span class="w">   </span><span class="c1"># Encryption format to use</span><span class="w"></span>
<span class="w">   </span><span class="c1"># Options are `sql` if you want to use Opaque SQL</span><span class="w"></span>
<span class="w">   </span><span class="c1"># or `xgb` if you want to use Secure XGBoost</span><span class="w"></span>
<span class="w">   </span><span class="nt">format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sql</span><span class="w"></span>

<span class="w">   </span><span class="c1"># Files to encrypt and upload</span><span class="w"></span>
<span class="w">   </span><span class="nt">src</span><span class="p">:</span><span class="w"></span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${MC2_CLIENT_HOME}/quickstart/data/opaquesql.csv</span><span class="w"></span>

<span class="w">   </span><span class="c1"># If you want to run Opaque SQL, you must also specify a schema,</span><span class="w"></span>
<span class="w">   </span><span class="c1"># one for each file you want to encrypt and upload</span><span class="w"></span>
<span class="w">   </span><span class="nt">schemas</span><span class="p">:</span><span class="w"></span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${MC2_CLIENT_HOME}/quickstart/data/opaquesql_schema.json</span><span class="w"></span>

<span class="w">   </span><span class="c1"># Directory to upload data to</span><span class="w"></span>
<span class="w">   </span><span class="nt">dst</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/mc2/data</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="run">
<h2>Run<a class="headerlink" href="#run" title="Permalink to this headline">¶</a></h2>
<p>In the <code class="docutils literal notranslate"><span class="pre">run</span></code> section, you should tell MC<sup>2</sup> Client that you’re running Opaque SQL, and specify an Opaque SQL script written in Scala. This section should look something like this:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">run</span><span class="p">:</span><span class="w"></span>
<span class="w">   </span><span class="c1"># Script to run</span><span class="w"></span>
<span class="w">   </span><span class="nt">script</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">opaque_sql_demo.scala</span><span class="w"></span>

<span class="w">   </span><span class="c1"># Compute service you're using</span><span class="w"></span>
<span class="w">   </span><span class="c1"># Choices are `xgb` or `sql`</span><span class="w"></span>
<span class="w">   </span><span class="nt">compute</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sql</span><span class="w"></span>

<span class="w">   </span><span class="c1"># Attestation configuration</span><span class="w"></span>
<span class="w">   </span><span class="nt">attestation</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="c1"># Whether we are running in simulation mode</span><span class="w"></span>
<span class="w">      </span><span class="c1"># If 0 (False), we are _not_ running in simulation mode,</span><span class="w"></span>
<span class="w">      </span><span class="c1"># and should verify the attestation evidence</span><span class="w"></span>
<span class="w">      </span><span class="nt">simulation_mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span><span class="w"></span>

<span class="w">      </span><span class="c1"># MRENCLAVE value to check</span><span class="w"></span>
<span class="w">      </span><span class="c1"># MRENCLAVE is a hash of the enclave build log</span><span class="w"></span>
<span class="w">      </span><span class="nt">mrenclave</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NULL</span><span class="w"></span>

<span class="w">      </span><span class="c1"># Path to MRSIGNER value to check</span><span class="w"></span>
<span class="w">      </span><span class="c1"># MRSIGNER is the key used to sign the built enclave</span><span class="w"></span>
<span class="w">      </span><span class="nt">mrsigner</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${MC2_CLIENT_HOME}/python-package/tests/keys/mc2_test_key.pub</span><span class="w"></span>

<span class="w">   </span><span class="c1"># The client consortium. Each username is mapped to a public key and</span><span class="w"></span>
<span class="w">   </span><span class="c1"># release policy</span><span class="w"></span>
<span class="w">   </span><span class="nt">consortium</span><span class="p">:</span><span class="w"></span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">user1</span><span class="w"></span>
<span class="w">       </span><span class="nt">public_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">keys/user1.pub</span><span class="w"></span>
<span class="w">       </span><span class="nt">result_release</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="download">
<h2>Download<a class="headerlink" href="#download" title="Permalink to this headline">¶</a></h2>
<p>In the download section, you should tell MC<sup>2</sup> Client that the results you are retrieving are encrypted by Opaque SQL. This section should look something like this:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">download</span><span class="p">:</span><span class="w"></span>
<span class="w">   </span><span class="c1"># Whether to download data from Azure blob storage or disk</span><span class="w"></span>
<span class="w">   </span><span class="c1"># Allowed values are `blob` or `disk`</span><span class="w"></span>
<span class="w">   </span><span class="c1"># If `blob`, Azure CLI will be called to download data</span><span class="w"></span>
<span class="w">   </span><span class="c1"># Else, `scp` will be used</span><span class="w"></span>
<span class="w">   </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">disk</span><span class="w"></span>

<span class="w">   </span><span class="c1"># Format this data is encrypted with</span><span class="w"></span>
<span class="w">   </span><span class="nt">format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sql</span><span class="w"></span>

<span class="w">   </span><span class="c1"># Directory/file to download</span><span class="w"></span>
<span class="w">   </span><span class="nt">src</span><span class="p">:</span><span class="w"></span>
<span class="w">   </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/mc2/opaque_sql_result</span><span class="w"></span>

<span class="w">   </span><span class="c1"># Local directory to download data to</span><span class="w"></span>
<span class="w">   </span><span class="nt">dst</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">results/</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h2>
<p>All together, the configuration file should look something like the following when running Opaque SQL.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># User configuration</span><span class="w"></span>
<span class="nt">user</span><span class="p">:</span><span class="w"></span>
<span class="w">   </span><span class="c1"># Your username - username should be specified in certificate</span><span class="w"></span>
<span class="w">   </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">user1</span><span class="w"></span>

<span class="w">   </span><span class="c1"># Path to your symmetric key - will be used for encryption/decryption</span><span class="w"></span>
<span class="w">   </span><span class="c1"># If you don't have a symmetric key, specify a path here</span><span class="w"></span>
<span class="w">   </span><span class="c1"># and run `MC2 init` to generate a key</span><span class="w"></span>
<span class="w">   </span><span class="c1">#</span><span class="w"></span>
<span class="w">   </span><span class="c1"># `MC2 init` will not overwrite anything at this path</span><span class="w"></span>
<span class="w">   </span><span class="nt">symmetric_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${MC2_CLIENT_HOME}/quickstart/keys/user1_sym.key</span><span class="w"></span>

<span class="w">   </span><span class="c1"># Path to your keypair and certificate</span><span class="w"></span>
<span class="w">   </span><span class="c1"># If you don't have a keypair / certificate, specify paths here</span><span class="w"></span>
<span class="w">   </span><span class="c1"># and run `MC2 init` to generate a keypair</span><span class="w"></span>
<span class="w">   </span><span class="c1">#</span><span class="w"></span>
<span class="w">   </span><span class="c1"># `MC2 init` will not overwrite anything at this path</span><span class="w"></span>
<span class="w">   </span><span class="nt">private_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${MC2_CLIENT_HOME}/quickstart/keys/user1.pem</span><span class="w"></span>
<span class="w">   </span><span class="nt">public_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${MC2_CLIENT_HOME}/quickstart/keys/user1.pub</span><span class="w"></span>
<span class="w">   </span><span class="nt">certificate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${MC2_CLIENT_HOME}/quickstart/keys/user1.crt</span><span class="w"></span>

<span class="w">   </span><span class="c1"># Path to CA certificate and private key</span><span class="w"></span>
<span class="w">   </span><span class="c1"># Needed if you want to generate a certificate signed by CA</span><span class="w"></span>
<span class="w">   </span><span class="nt">root_certificate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${MC2_CLIENT_HOME}/quickstart/keys/root.crt</span><span class="w"></span>
<span class="w">   </span><span class="nt">root_private_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${MC2_CLIENT_HOME}/quickstart/keys/root.pem</span><span class="w"></span>

<span class="c1"># Configuration for launching cloud resources</span><span class="w"></span>
<span class="nt">launch</span><span class="p">:</span><span class="w"></span>
<span class="w">   </span><span class="c1"># The absolute path to your Azure configuraton</span><span class="w"></span>
<span class="w">   </span><span class="c1"># This needs to be an absolute path</span><span class="w"></span>
<span class="w">   </span><span class="nt">azure_config</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${MC2_CLIENT_HOME}/quickstart/azure.yaml</span><span class="w"></span>

<span class="w">   </span><span class="c1"># Whether to launch a cluster of VMs</span><span class="w"></span>
<span class="w">   </span><span class="nt">cluster</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>

<span class="w">   </span><span class="c1"># Whether to launch Azure blob storage</span><span class="w"></span>
<span class="w">   </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>

<span class="w">   </span><span class="c1"># Whether to launch a storage container</span><span class="w"></span>
<span class="w">   </span><span class="nt">container</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>

<span class="c1"># Commands to start compute service</span><span class="w"></span>
<span class="nt">start</span><span class="p">:</span><span class="w"></span>
<span class="w">   </span><span class="c1"># Commands to run on head node</span><span class="w"></span>
<span class="w">   </span><span class="c1"># This command is used to start the Opaque SQL service on the head node locally</span><span class="w"></span>
<span class="w">   </span><span class="nt">head</span><span class="p">:</span><span class="w"></span>
<span class="w">   </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cd /mc2/opaque-sql; build/sbt run</span><span class="w"></span>

<span class="w">   </span><span class="c1"># Commands to run on worker nodes</span><span class="w"></span>
<span class="w">   </span><span class="c1"># For this quickstart there is only one node - no worker nodes</span><span class="w"></span>
<span class="w">   </span><span class="nt">workers</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span><span class="w"></span>

<span class="c1"># Configuration for `MC2 upload`</span><span class="w"></span>
<span class="nt">upload</span><span class="p">:</span><span class="w"></span>
<span class="w">   </span><span class="c1"># Whether to upload data to Azure blob storage or disk</span><span class="w"></span>
<span class="w">   </span><span class="c1"># Allowed values are `blob` or `disk`</span><span class="w"></span>
<span class="w">   </span><span class="c1"># If `blob`, Azure CLI will be called to upload data</span><span class="w"></span>
<span class="w">   </span><span class="c1"># Else, `scp` will be used</span><span class="w"></span>
<span class="w">   </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">disk</span><span class="w"></span>

<span class="w">   </span><span class="c1"># Encryption format to use</span><span class="w"></span>
<span class="w">   </span><span class="c1"># Options are `sql` if you want to use Opaque SQL</span><span class="w"></span>
<span class="w">   </span><span class="c1"># or `xgb` if you want to use Secure XGBoost</span><span class="w"></span>
<span class="w">   </span><span class="nt">format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sql</span><span class="w"></span>

<span class="w">   </span><span class="c1"># Files to encrypt and upload</span><span class="w"></span>
<span class="w">   </span><span class="nt">src</span><span class="p">:</span><span class="w"></span>
<span class="w">   </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${MC2_CLIENT_HOME}/quickstart/data/opaquesql.csv</span><span class="w"></span>

<span class="w">   </span><span class="c1"># If you want to run Opaque SQL, you must also specify a schema,</span><span class="w"></span>
<span class="w">   </span><span class="c1"># one for each file you want to encrypt and upload</span><span class="w"></span>
<span class="w">   </span><span class="nt">schemas</span><span class="p">:</span><span class="w"></span>
<span class="w">   </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${MC2_CLIENT_HOME}/quickstart/data/opaquesql_schema.json</span><span class="w"></span>

<span class="w">   </span><span class="c1"># Directory to upload data to</span><span class="w"></span>
<span class="w">   </span><span class="nt">dst</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/mc2/data</span><span class="w"></span>


<span class="c1"># Computation configuration</span><span class="w"></span>
<span class="nt">run</span><span class="p">:</span><span class="w"></span>
<span class="w">   </span><span class="c1"># Script to run</span><span class="w"></span>
<span class="w">   </span><span class="nt">script</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">opaque_sql_demo.scala</span><span class="w"></span>

<span class="w">   </span><span class="c1"># Compute service you're using</span><span class="w"></span>
<span class="w">   </span><span class="c1"># Choices are `xgb` or `sql`</span><span class="w"></span>
<span class="w">   </span><span class="nt">compute</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sql</span><span class="w"></span>

<span class="w">   </span><span class="c1"># Attestation configuration</span><span class="w"></span>
<span class="w">   </span><span class="nt">attestation</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="c1"># Whether we are running in simulation mode</span><span class="w"></span>
<span class="w">      </span><span class="c1"># If 0 (False), we are _not_ running in simulation mode,</span><span class="w"></span>
<span class="w">      </span><span class="c1"># and should verify the attestation evidence</span><span class="w"></span>
<span class="w">      </span><span class="nt">simulation_mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span><span class="w"></span>

<span class="w">      </span><span class="c1"># MRENCLAVE value to check</span><span class="w"></span>
<span class="w">      </span><span class="c1"># MRENCLAVE is a hash of the enclave build log</span><span class="w"></span>
<span class="w">      </span><span class="nt">mrenclave</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NULL</span><span class="w"></span>

<span class="w">      </span><span class="c1"># Path to MRSIGNER value to check</span><span class="w"></span>
<span class="w">      </span><span class="c1"># MRSIGNER is the key used to sign the built enclave</span><span class="w"></span>
<span class="w">      </span><span class="c1"># This key should be used for testing purposes only,</span><span class="w"></span>
<span class="w">      </span><span class="c1"># and is not secure for production purpose.</span><span class="w"></span>
<span class="w">      </span><span class="nt">mrsigner</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${MC2_CLIENT_HOME}/python-package/tests/keys/mc2_test_key.pub</span><span class="w"></span>

<span class="w">   </span><span class="c1"># The client consortium. Each username is mapped to a public key and</span><span class="w"></span>
<span class="w">   </span><span class="c1"># release policy</span><span class="w"></span>
<span class="w">   </span><span class="nt">consortium</span><span class="p">:</span><span class="w"></span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">user1</span><span class="w"></span>
<span class="w">       </span><span class="nt">public_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">keys/user1.pub</span><span class="w"></span>
<span class="w">       </span><span class="nt">result_release</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>

<span class="w">  </span><span class="c1"># Configuration for downloading results</span><span class="w"></span>
<span class="w w-Error">  </span><span class="nt">download</span><span class="p">:</span><span class="w"></span>
<span class="w">     </span><span class="c1"># Whether to download data from Azure blob storage or disk</span><span class="w"></span>
<span class="w">     </span><span class="c1"># Allowed values are `blob` or `disk`</span><span class="w"></span>
<span class="w">     </span><span class="c1"># If `blob`, Azure CLI will be called to download data</span><span class="w"></span>
<span class="w">     </span><span class="c1"># Else, `scp` will be used</span><span class="w"></span>
<span class="w">     </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">disk</span><span class="w"></span>

<span class="w">     </span><span class="c1"># Format this data is encrypted with</span><span class="w"></span>
<span class="w">     </span><span class="nt">format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sql</span><span class="w"></span>

<span class="w">     </span><span class="c1"># Directory/file to download</span><span class="w"></span>
<span class="w">     </span><span class="c1"># FIXME: If storage is `blob` this value must be a file</span><span class="w"></span>
<span class="w">     </span><span class="c1"># Need to investigate whether we can use directories in Azure blob storage</span><span class="w"></span>
<span class="w">     </span><span class="nt">src</span><span class="p">:</span><span class="w"></span>
<span class="w">       </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/mc2/opaque_sql_result</span><span class="w"></span>

<span class="w">     </span><span class="c1"># Local directory to download data to</span><span class="w"></span>
<span class="w">     </span><span class="nt">dst</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">results/</span><span class="w"></span>

<span class="w">  </span><span class="c1"># Configuration for stopping services</span><span class="w"></span>
<span class="w">  </span><span class="nt">stop</span><span class="p">:</span><span class="w"></span>

<span class="w">  </span><span class="c1"># Configuration for deleting Azure resources</span><span class="w"></span>
<span class="w">  </span><span class="nt">teardown</span><span class="p">:</span><span class="w"></span>
<span class="w">     </span><span class="c1"># Whether to terminate launched VMs</span><span class="w"></span>
<span class="w">     </span><span class="nt">cluster</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>

<span class="w">     </span><span class="c1"># Whether to terminate created Azure blob storage</span><span class="w"></span>
<span class="w">     </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>

<span class="w">     </span><span class="c1"># Whether to terminate created storage container</span><span class="w"></span>
<span class="w">     </span><span class="nt">container</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>

<span class="w">     </span><span class="c1"># Whether to terminate specified resource group</span><span class="w"></span>
<span class="w">     </span><span class="nt">resource_group</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="config/index.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Configuration</div>
              </div>
              <svg><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="quickstart.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Quickstart</div>
                
              </div>
            </a>
        </div>

        <div class="related-information">
              Copyright &#169; 2021, MC² Team |
          Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
          <a href="https://github.com/pradyunsg/furo">Furo theme</a>.
            | <a class="muted-link" href="_sources/opaquesql_usage.rst.txt"
               rel="nofollow">
              Show Source
            </a>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Contents
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Usage with Opaque SQL</a><ul>
<li><a class="reference internal" href="#start">Start</a></li>
<li><a class="reference internal" href="#upload">Upload</a></li>
<li><a class="reference internal" href="#run">Run</a></li>
<li><a class="reference internal" href="#download">Download</a></li>
<li><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/scripts/furo.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    </body>
</html>